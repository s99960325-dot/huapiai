import{A as f,d as Q,x as R,c as b,a as l,w as a,k as c,E as o,r as s,o as g,B as j,m as G,h as r,v as y,i as u,f as J,F as O,n as W,y as X,p as Y,q as Z,C as ee,D as le,_ as ae}from"./index-cIS50Myt.js";function te(){return f.get("/api/plugin")}function ne(i){return f.post(`/api/plugin/${i}/uninstall`)}function se(i){return f.post(`/api/plugin/${i}/enable`)}function oe(i){return f.post(`/api/plugin/${i}/disable`)}function ie(i){return f.get("/api/plugin/market/search",{params:{query:i}})}const ue={class:"plugin-view"},re={class:"card-header"},de={key:0,class:"search-results"},ce={class:"plugin-info"},pe={class:"plugin-name"},_e={class:"plugin-desc"},me=Q({__name:"PluginView",setup(i){const k=c(!1),p=c(!1),V=c("market"),v=c(""),w=c([]),h=c([]),z=Y(()=>({Authorization:`Bearer ${le.get("token")}`})),_=async()=>{k.value=!0;try{const n=await te();w.value=n.plugins||[]}catch{o.error("加载数据失败")}finally{k.value=!1}},B=async n=>{try{n.enabled?(await oe(n.id),o.success("已禁用")):(await se(n.id),o.success("已启用")),_()}catch{o.error("操作失败")}},D=async n=>{try{await Z.confirm(`确定要卸载插件 "${n.name}" 吗？`,"提示",{type:"warning"}),await ne(n.id),o.success("卸载成功"),_()}catch{}},C=async()=>{if(v.value)try{const n=await ie(v.value);h.value=n.results||[]}catch{o.error("搜索失败")}},U=async n=>{try{o.success("安装成功"),p.value=!1,_()}catch{o.error("安装失败")}},E=()=>{o.success("上传成功"),p.value=!1,_()},I=()=>{o.error("上传失败")};return R(()=>{_()}),(n,e)=>{const N=s("Plus"),P=s("el-icon"),m=s("el-button"),d=s("el-table-column"),M=s("el-tag"),q=s("el-table"),A=s("el-card"),F=s("el-input"),$=s("el-tab-pane"),K=s("upload-filled"),S=s("el-upload"),T=s("el-tabs"),H=s("el-dialog"),L=ee("loading");return g(),b("div",ue,[l(A,null,{header:a(()=>[u("div",re,[e[5]||(e[5]=u("span",null,"插件管理",-1)),l(m,{type:"primary",onClick:e[0]||(e[0]=t=>p.value=!0)},{default:a(()=>[l(P,null,{default:a(()=>[l(N)]),_:1}),e[4]||(e[4]=r("安装插件 ",-1))]),_:1})])]),default:a(()=>[j((g(),G(q,{data:w.value,stripe:""},{default:a(()=>[l(d,{prop:"id",label:"插件ID"}),l(d,{prop:"name",label:"名称"}),l(d,{prop:"version",label:"版本",width:"100"}),l(d,{prop:"description",label:"描述","show-overflow-tooltip":""}),l(d,{label:"状态",width:"100"},{default:a(({row:t})=>[l(M,{type:t.enabled?"success":"info"},{default:a(()=>[r(y(t.enabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"操作",width:"250"},{default:a(({row:t})=>[l(m,{type:t.enabled?"danger":"success",size:"small",onClick:x=>B(t)},{default:a(()=>[r(y(t.enabled?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(m,{type:"danger",size:"small",onClick:x=>D(t)},{default:a(()=>[...e[6]||(e[6]=[r("卸载",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,k.value]])]),_:1}),l(H,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=t=>p.value=t),title:"安装插件",width:"500px"},{default:a(()=>[l(T,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=t=>V.value=t)},{default:a(()=>[l($,{label:"从市场安装",name:"market"},{default:a(()=>[l(F,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),placeholder:"搜索插件...",onKeyup:J(C,["enter"])},{append:a(()=>[l(m,{onClick:C},{default:a(()=>[...e[7]||(e[7]=[r("搜索",-1)])]),_:1})]),_:1},8,["modelValue"]),h.value.length>0?(g(),b("div",de,[(g(!0),b(O,null,W(h.value,t=>(g(),b("div",{key:t.id,class:"plugin-item"},[u("div",ce,[u("div",pe,y(t.name),1),u("div",_e,y(t.description),1)]),l(m,{type:"primary",size:"small",onClick:x=>U(t.id)},{default:a(()=>[...e[8]||(e[8]=[r("安装",-1)])]),_:1},8,["onClick"])]))),128))])):X("",!0)]),_:1}),l($,{label:"本地安装",name:"local"},{default:a(()=>[l(S,{drag:"",action:"/backend-api/api/plugin/install-from-file",headers:z.value,"on-success":E,"on-error":I,accept:".zip,.tar.gz"},{tip:a(()=>[...e[9]||(e[9]=[u("div",{class:"el-upload__tip"}," 支持 .zip 和 .tar.gz 格式的插件包 ",-1)])]),default:a(()=>[l(P,{class:"el-icon--upload"},{default:a(()=>[l(K)]),_:1}),e[10]||(e[10]=u("div",{class:"el-upload__text"},[r(" 拖拽文件到此处或 "),u("em",null,"点击上传")],-1))]),_:1},8,["headers"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}}),fe=ae(me,[["__scopeId","data-v-189b9413"]]);export{fe as default};
