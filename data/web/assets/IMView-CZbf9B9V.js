import{A as c,d as L,x as j,c as $,a,w as l,k as p,E as i,r as o,o as v,B as G,m as A,h as u,v as M,i as B,F as H,n as K,p as Q,q as W,C as X,_ as Y}from"./index-cIS50Myt.js";function Z(){return c.get("/api/im/types")}function h(){return c.get("/api/im/adapters")}function ee(s){return c.post("/api/im/adapters",s)}function te(s){return c.delete(`/api/im/adapters/${s}`)}function ae(s){return c.post(`/api/im/adapters/${s}/start`)}function le(s){return c.post(`/api/im/adapters/${s}/stop`)}const ne={class:"im-view"},oe={class:"card-header"},se=L({__name:"IMView",setup(s){const g=p(!1),y=p(!1),m=p(!1),b=p([]),C=p([]),r=p({name:"",adapter:"",config:{}}),k=Q({get:()=>JSON.stringify(r.value.config,null,2),set:n=>{try{r.value.config=JSON.parse(n)}catch{}}}),_=async()=>{g.value=!0;try{const n=await h(),e=await Z();b.value=n.adapters||[],C.value=e.types||[]}catch{i.error("加载数据失败")}finally{g.value=!1}},D=async()=>{y.value=!0;try{await ee(r.value),i.success("创建成功"),m.value=!1,_()}catch{i.error("创建失败")}finally{y.value=!1}},N=async n=>{try{n.is_running?(await le(n.name),i.success("已停止")):(await ae(n.name),i.success("已启动")),_()}catch{i.error("操作失败")}},E=n=>{i.info("编辑功能开发中")},I=async n=>{try{await W.confirm(`确定要删除适配器 "${n.name}" 吗？`,"提示",{type:"warning"}),await te(n.name),i.success("删除成功"),_()}catch{}};return j(()=>{_()}),(n,e)=>{const J=o("Plus"),S=o("el-icon"),d=o("el-button"),f=o("el-table-column"),U=o("el-tag"),z=o("el-table"),O=o("el-card"),w=o("el-input"),V=o("el-form-item"),T=o("el-option"),q=o("el-select"),F=o("el-form"),P=o("el-dialog"),R=X("loading");return v(),$("div",ne,[a(O,null,{header:l(()=>[B("div",oe,[e[7]||(e[7]=B("span",null,"消息平台管理",-1)),a(d,{type:"primary",onClick:e[0]||(e[0]=t=>m.value=!0)},{default:l(()=>[a(S,null,{default:l(()=>[a(J)]),_:1}),e[6]||(e[6]=u("添加适配器 ",-1))]),_:1})])]),default:l(()=>[G((v(),A(z,{data:b.value,stripe:""},{default:l(()=>[a(f,{prop:"name",label:"名称"}),a(f,{prop:"adapter",label:"适配器类型"}),a(f,{label:"运行状态"},{default:l(({row:t})=>[a(U,{type:t.is_running?"success":"info"},{default:l(()=>[u(M(t.is_running?"运行中":"已停止"),1)]),_:2},1032,["type"])]),_:1}),a(f,{label:"操作",width:"300"},{default:l(({row:t})=>[a(d,{type:t.is_running?"danger":"success",size:"small",onClick:x=>N(t)},{default:l(()=>[u(M(t.is_running?"停止":"启动"),1)]),_:2},1032,["type","onClick"]),a(d,{type:"primary",size:"small",onClick:x=>E(t)},{default:l(()=>[...e[8]||(e[8]=[u("编辑",-1)])]),_:1},8,["onClick"]),a(d,{type:"danger",size:"small",onClick:x=>I(t)},{default:l(()=>[...e[9]||(e[9]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,g.value]])]),_:1}),a(P,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t),title:"添加IM适配器",width:"600px"},{footer:l(()=>[a(d,{onClick:e[4]||(e[4]=t=>m.value=!1)},{default:l(()=>[...e[10]||(e[10]=[u("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:D,loading:y.value},{default:l(()=>[...e[11]||(e[11]=[u("确定",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(F,{model:r.value,"label-width":"120px"},{default:l(()=>[a(V,{label:"名称"},{default:l(()=>[a(w,{modelValue:r.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.name=t),placeholder:"请输入适配器名称"},null,8,["modelValue"])]),_:1}),a(V,{label:"适配器类型"},{default:l(()=>[a(q,{modelValue:r.value.adapter,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.adapter=t),placeholder:"选择适配器类型"},{default:l(()=>[(v(!0),$(H,null,K(C.value,t=>(v(),A(T,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(V,{label:"配置"},{default:l(()=>[a(w,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t),type:"textarea",rows:5,placeholder:"JSON格式配置"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ie=Y(se,[["__scopeId","data-v-2239a2a0"]]);export{ie as default};
